<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<style>
  input {
    width: 200px;
  }

  #movies {
    height: 200px;
    width: 206px;
    border: 1px solid black;
    overflow: scroll;
    border-top: none;
  }
</style>

<body>
  <input oninput="debounce(main,1000)" type="text" id="movie" placeholder="Enter movie name" />
  <div id="movies"></div>
</body>
<script>

  let movie_div = document.getElementById('movies')
let timerId;
  async function searchMovies(movie_name) {
    try {
      let res = await fetch(`https://www.omdbapi.com/?s=${movie_name}&apikey=68bfdedf`)
      let data = await res.json()
      return data;
    }
    catch (e) {
      console.log(e)
    }
  }

function appendMovies(movies){

  if(movies==undefined){
    return false
  }
  
  movie_div.innerHTML=null;
  movies.forEach(function(movie){
    let p=document.createElement('p')
    p.innerText=movie.Title;
    movie_div.append(p)
    p.onclick=function(){
      movieee(movie)
    }
  })
}


async function movieee(dd) {

console.log(dd.imdbID)
let res = await fetch(`https://www.omdbapi.com/?i=${dd.imdbID}&apikey=68bfdedf`)
let data = await res.json()
console.log(data)

localStorage.setItem('moviedetails11', JSON.stringify(data))

window.location.href = 'movieDetail.html';


}

async function main(){
  let name= document.getElementById('movie').value;
  if(name.length<3)
  {
    return false;
  }

  let res=await searchMovies(name)
  let movies=res.Search
  appendMovies(movies)
  console.log(movies)

}

function debounce(func,time){
if(timerId)
  clearTimeout(timerId)
  timerId=setTimeout(function(){
    func()
  },time)

}

  
</script>